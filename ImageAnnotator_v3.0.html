<!DOCTYPE html>
<html lang="ko">
<meta charset="utf-8">
<title>Image Annotator v2.2 (Draw / Text / Save)</title>
<style>
  body{font-family:Segoe UI,system-ui,sans-serif;background:#f1f3f5;margin:0}
  .wrap{max-width:980px;margin:20px auto;background:#fff;padding:16px 18px;border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.08)}
  h1{font-size:20px;margin:0 0 6px}
  .note{color:#444;margin:0 0 10px}
  #c{background:#fff;border:1px solid #bbb;width:920px;height:520px;display:block;margin:12px auto}
  .bar{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  .btn{background:#1976d2;color:#fff;border:none;border-radius:8px;padding:8px 12px;cursor:pointer}
  .in{border:1px solid #bbb;border-radius:8px;padding:6px 10px}
  .tip{color:#666;text-align:center;margin-top:6px}
</style>
<div class="wrap">
  <h1>ğŸ–Š Image Annotator v2.2</h1>
  <p class="note">ì´ë¯¸ì§€ë¥¼ <b>ë“œë˜ê·¸/ì—…ë¡œë“œ</b>í•˜ê±°ë‚˜, <b>Ctrl+V(ë¶™ì—¬ë„£ê¸°)</b>ë¡œ í´ë¦½ë³´ë“œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”. (AHK v2.2: Ctrl+Alt+X / Ctrl+Alt+Shift+X)</p>
  <div class="bar">
    <input type="file" id="file" class="in">
    <button class="btn" id="pen">íœ (P)</button>
    <button class="btn" id="line">ì§ì„  (L)</button>
    <button class="btn" id="text">í…ìŠ¤íŠ¸ (T)</button>
    <button class="btn" id="undo">ì‹¤í–‰ì·¨ì†Œ (Ctrl+Z)</button>
    <button class="btn" id="save">PNG ì €ì¥</button>
  </div>
  <canvas id="c" width="920" height="520"></canvas>
  <p class="tip">íŒ: AHK v2.2ì—ì„œ <b>í˜„ì¬ ì°½ ìº¡ì²˜</b>ëŠ” Ctrl+Alt+X, <b>ì „ì²´ í™”ë©´ ìº¡ì²˜</b>ëŠ” Ctrl+Alt+Shift+X â†’ ì´ í˜ì´ì§€ ìë™ ì—´ë¦¼ í›„ Ctrl+V ìë™ ì‹¤í–‰ìœ¼ë¡œ ì´ë¯¸ì§€ê°€ ë¶™ìŠµë‹ˆë‹¤.</p>
</div>
<script>
const c=document.getElementById('c'),x=c.getContext('2d');let mode='pen',down=false,sx=0,sy=0,h=[];
function loadImgURL(url){const i=new Image();i.onload=()=>{x.clearRect(0,0,c.width,c.height);x.drawImage(i,0,0,c.width,c.height)};i.src=url}
function loadImgFile(f){const r=new FileReader();r.onload=e=>loadImgURL(e.target.result);r.readAsDataURL(f)}
document.getElementById('file').onchange=e=>e.target.files[0]&&loadImgFile(e.target.files[0]);
c.ondrop=e=>{e.preventDefault();if(e.dataTransfer.files[0])loadImgFile(e.dataTransfer.files[0])}
c.ondragover=e=>e.preventDefault();
window.addEventListener('paste', async e=>{
  const items = e.clipboardData?.items||[];
  for (const it of items){
    if (it.type?.startsWith('image/')){
      const blob = it.getAsFile();
      const url  = URL.createObjectURL(blob);
      loadImgURL(url);
      return;
    }
  }
  alert('í´ë¦½ë³´ë“œì— ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. (ìŠ¤í¬ë¦°ìƒ· í›„ Ctrl+V)');
});
function save(){h.push(c.toDataURL());}
document.getElementById('pen').onclick=()=>mode='pen';
document.getElementById('line').onclick=()=>mode='line';
document.getElementById('text').onclick=()=>mode='text';
document.getElementById('undo').onclick=()=>{if(!h.length)return;const i=new Image();i.onload=()=>x.drawImage(i,0,0);i.src=h.pop();}
document.getElementById('save').onclick=()=>{const a=document.createElement('a');a.download='annotated.png';a.href=c.toDataURL('image/png');a.click();}
let buf;
c.onmousedown=e=>{down=true;sx=e.offsetX;sy=e.offsetY;save();buf=x.getImageData(0,0,c.width,c.height);if(mode==='text'){const t=prompt('í…ìŠ¤íŠ¸ ì…ë ¥:');if(t){x.fillStyle='#111';x.font='18px \"Malgun Gothic\",sans-serif';x.fillText(t,sx,sy)}down=false}};
c.onmousemove=e=>{if(!down)return;if(mode==='pen'){x.lineCap='round';x.strokeStyle='#111';x.lineWidth=2;x.lineTo(e.offsetX,e.offsetY);x.stroke()}else if(mode==='line'){x.putImageData(buf,0,0);x.beginPath();x.moveTo(sx,sy);x.lineTo(e.offsetX,e.offsetY);x.stroke()}};
c.onmouseup=()=>down=false;
// í¬ì»¤ìŠ¤ ì£¼ê¸° (AHKê°€ ì—´ê³  Ctrl+V ë³´ë‚¼ ë•Œ ë¶™ì—¬ë„£ê¸° ë°›ë„ë¡)
window.addEventListener('load',()=>c.focus());
c.setAttribute("tabindex","0");
</script>
</html>
